---
title: 内网仓库搭建
date: 2018-03-18 12:13:23
tags: 
    - yum
    - apt-get
categories: linux
---

应对服务器不能去外网的情况
<!--more-->

不同版本的系统,配置等都不一样,过程无二

### yum

#### 通过iso
将对应系统iso挂载到系统(vmware去配置中添加CD)

创建mount文件路径并将CD挂载到系统
`mkdir /mnt/yum-iso`
`mount /dev/cdrom /mnt/yum-iso/`

创建目录,并将iso复制到系统,用来制作yum源
`mkdir /yum` `cp -a /mnt/yum-iso/ /yum/`

备份原有的yum仓库配置
`cd /etc/yum.repos.d/` 
`mkdir bk` 
`mv *.repo bk/`

创建本地yum仓库配置

`vi local-iso.repo`
```
[centos7-iso]
name=CentOS-$releasever - Media
baseurl=file:///yum/yum-iso/
gpgcheck=0
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
```

清理缓存,制作本地缓存
`yum clean all`
`yum makecaches`


#### 自定义yum源
安装软件
`yum -y install createrepo`

创建yum源文件目录
`mkdir -p /yum/yum-custom/packages`
将搜集的源放置相应目录
`cp 源文件 /yum/yum-custom/packages/`
创建repo,会生成repodata目录
`createrepo -u -d  /yum/yum-custom/`
配置repo
`cd /etc/yum.repos.d/`
`vi local.repo`
```
[centos7-custom]
name=CentOS-$releasever - Media
baseurl=file:///yum/yum-custom/
gpgcheck=0
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
```
清理缓存,制作本地缓存
`yum clean all`
`yum makecaches`

#### 局域网yum源

搭建ftp服务器
`yum -y install vsftpd`
配置ftp
`vi /etc/vsftpd/vsftpd.conf` `anon_root=/yum/`(yum目录权限drwxr-xr-x)
启动ftp
`systemctl start vsftpd` `systemctl enable vsftpd`

其他主机使用此仓库,添加仓库配置文件

`vim /etc/yum.repos.d/local-ftp.repo`

```
[centos7-ftp]
name=CentOS-$releasever - Media
baseurl=ftp://192.168.1.96/yum-custom
gpgcheck=0
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
```

### apt-get
等后续

----